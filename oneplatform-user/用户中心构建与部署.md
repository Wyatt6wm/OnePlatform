# 用户中心构建与部署

由于涉及到连接数据库和缓存，在本地容器运行连接测试服务器，在服务器运行连接生产服务器。构建镜像前，先修改环境标志，如果是在本地运行则修改成`localrun`，如果是在服务器运行则修改成`run`。再 maven install 构建 jar 包：

```yaml
spring:
  profiles:
    active: run
```

在项目根目录下构建 Dockerfile，按照如下模板填入构建命令：

```dockerfile
FROM openjdk:15.0.2-oraclelinux8
ADD target/oneplatform-user.jar application.jar
ENTRYPOINT ["java", "-jar", "/application.jar"]
EXPOSE 8002
```

构建镜像并推送到 dockerhub 仓库（注意标签版本号）：

```shell
# 在Dockerfile文件所在目录下运行
docker build -t wyatt6/oneplatform-user:1.0.0 ./
docker push wyatt6/oneplatform-user:1.0.0
```

拉取镜像（注意标签版本号）：

```shell
docker network create oneplatform-net
docker pull wyatt6/oneplatform-user:1.0.0
```

运行容器（注意标签版本号），如果是在服务器运行不暴露端口：

```shell
# 本地
docker run --name oneplatform-user -d -p 8002:8002/tcp --net oneplatform-net --restart=unless-stopped -e TZ="Asia/Shanghai" wyatt6/oneplatform-user:1.0.0

# 服务器
docker run --name oneplatform-user -d --net oneplatform-net --restart=unless-stopped -e TZ="Asia/Shanghai" wyatt6/oneplatform-user:1.0.0
```

